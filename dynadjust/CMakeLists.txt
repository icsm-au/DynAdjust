cmake_minimum_required (VERSION 3.0)

project (dynadjust)

set (DYNADJUST_VERSION "1.1.0")

if (BUILD_TESTING)
    enable_testing()
endif (BUILD_TESTING)

if(NOT CMAKE_BUILD_TYPE)
  set(CMAKE_BUILD_TYPE Release)
endif()

#set(CMAKE_VERBOSE_MAKEFILE ON)

message (" ")
message ("===========================================================================")
message ("Configuring DynAdjust ${DYNADJUST_VERSION} (${CMAKE_BUILD_TYPE}) build using cmake...")
message (" ")

if(UNIX)
   set(DNA_PROGRAM_PREFIX "dna")
endif(UNIX)

set (CMAKE_MODULE_PATH "${CMAKE_CURRENT_LIST_DIR};${CMAKE_MODULE_PATH}")
set (CMAKE_CXX_STANDARD 14)
add_definitions(-Wno-deprecated-declarations)

# default CXX flags
if (BUILD_TESTING)
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -w")    # turn off warnings for unit testing and code coverage
else ()
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall")
endif (BUILD_TESTING)

# Debug CXX flags (GCC 4.8 introduced -Og for superior debugging experience. For older versions, use -O0)
set(CMAKE_CXX_FLAGS_DEBUG "${CMAKE_CXX_FLAGS_DEBUG} -ggdb -Og")

# If testing, then include coverage and turn off optimisations for release builds
if (BUILD_TESTING)
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} --coverage")
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fprofile-arcs")
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -ftest-coverage")
    set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} --coverage")
endif (BUILD_TESTING)

if (CMAKE_SYSTEM_NAME MATCHES "Darwin")
    set (CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -Wl")
else()
    set (CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -Wl,--no-as-needed")
endif()

message (STATUS "Looking for xerces-c...")
find_package (XercesC COMPONENTS xerces-c REQUIRED)
if (NOT XERCESC_FOUND )
   set (DNA_BUILD_ERROR 1)
   set (XERCES_FIND_ERROR 1)
   message (SEND_ERROR "Cannot find XercesC library")
else ()
   message (STATUS "xerces-c seems to be installed correctly.")
endif ()
message (" ")

message (STATUS "Looking for xsd headers...")
find_package (XSD REQUIRED)
if (NOT XSD_FOUND )
   set (DNA_BUILD_ERROR 1)
   set (XSD_FIND_ERROR 1)
   message (SEND_ERROR "Cannot find XSD library")
else ()
   message (STATUS "xsd headers seem to be installed correctly.")
endif ()
message (" ")

message (STATUS "Looking for boost...")
set (Boost_USE_MULTITHREADED ON)
set (BOOST_MIN_VERSION "1.58.0")
find_package (Boost ${BOOST_MIN_VERSION} COMPONENTS system filesystem timer thread program_options REQUIRED)
if (NOT Boost_FOUND )
   set (DNA_BUILD_ERROR 1)
   set (BOOST_FIND_ERROR 1)
   message (SEND_ERROR "Cannot find Boost library components")
else ()
   message (STATUS "boost seems to be installed correctly.")
endif ()
message (" ")

message (STATUS "Looking for intel math kernel library (mkl)...")
find_package (MKL COMPONENTS mkl_blas95_ilp64 mkl_intel_ilp64 mkl_intel_thread mkl_core REQUIRED)
if (NOT MKL_FOUND )
   set (DNA_BUILD_ERROR 1)
   set (MKL_FIND_ERROR 1)
   message (SEND_ERROR "Cannot find MKL library components")
else ()
    message (STATUS "MKL seems to be installed correctly.")
endif ()
message (" ")

if (CMAKE_SYSTEM_NAME MATCHES "Darwin")
    find_library(IOMP5_LIB iomp5 PATHS /opt/intel/lib)
else()
    find_library(IOMP5_LIB iomp5 PATHS /opt/intel/lib/intel64)
endif()
if( NOT IOMP5_LIB )
   set(DNA_BUILD_ERROR 1)
   set (IOMP5_FIND_ERROR 1)
   message(SEND_ERROR "Cannot find iomp5 library")
endif()

set (DNA_LIBRARIES ${Boost_LIBRARIES} ${XERCESC_LIBRARY} ${MKL_LIBRARIES} ${IOMP5_LIB})

message (STATUS "DynAdjust library dependencies:")
message (STATUS ${DNA_LIBRARIES})
message (" ")

include_directories( ${CMAKE_SOURCE_DIR} ${Boost_INCLUDE_DIRS} ${MKL_INCLUDE_DIRS} ${XERCESC_INCLUDE_DIR} ${XSD_INCLUDE_DIR})

if (DNA_BUILD_ERROR)
    message (" ")
    message (STATUS "**********************************************")
    message (STATUS "Cannot build DynaAjust ${DYNADJUST_VERSION}.  Missing components:")
if (XERCES_FIND_ERROR)
    message (STATUS "  xerces-c")
endif ()
if (XSD_FIND_ERROR)
    message (STATUS "  xsd headers")
endif ()
if (BOOST_FIND_ERROR)
    message (STATUS "  boost")
endif ()
if (MKL_FIND_ERROR)
    message (STATUS "  mkl")
endif ()
if (IOMP5_FIND_ERROR)
    message (STATUS "  iomp5")
endif ()
    message (" ")
    message (FATAL_ERROR "Build terminating.")
endif ()

message (STATUS "Configuring import")
add_subdirectory (dynadjust/dnaimportwrapper)

message (STATUS "Configuring reftran")
add_subdirectory (dynadjust/dnareftranwrapper)

message (STATUS "Configuring segment")
add_subdirectory (dynadjust/dnasegmentwrapper)

message (STATUS "Configuring geoid")
add_subdirectory (dynadjust/dnageoidwrapper)

message (STATUS "Configuring adjust")
add_subdirectory (dynadjust/dnaadjustwrapper)

message (STATUS "Configuring plot")
add_subdirectory (dynadjust/dnaplotwrapper)

message (STATUS "Configuring dynadjust")
add_subdirectory (dynadjust/dynadjust)

if (BUILD_TESTING)
    message ("  ")
    message (STATUS "Configuring tests")
    
    # test execution of dynadjust binaries
    # 1. gnss network (simultaneous, phased-block 1, phased, staged)
    add_test (NAME import-gnss-network COMMAND $<TARGET_FILE:dnaimportwrapper> -n gnss ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network.stn ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network.msr --export-dna --export-xml --export-asl --export-aml --export-map --output-msr-to-stn --test-integrity -r GDA94) 
    add_test (NAME geoid-gnss-network COMMAND $<TARGET_FILE:dnageoidwrapper> gnss -g ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network-geoid.gsb --convert-stn-hts --export-dna-geo)
    add_test (NAME reftran-gnss-network COMMAND $<TARGET_FILE:dnareftranwrapper> gnss -r gda2020 --export-dna --export-xml)
    add_test (NAME adjust-gnss-network COMMAND $<TARGET_FILE:dnaadjustwrapper> gnss --output-adj-msr --export-dna-msr --export-xml-msr)

    # bash command to check results
    add_test (NAME test-gnss-network COMMAND bash -c "diff <(tail -n +53 gnss.simult.adj) <(tail -n +53 ${CMAKE_SOURCE_DIR}/../sampleData/gnss.simult.adj.expected)")
    
    file (COPY ${CMAKE_SOURCE_DIR}/../sampleData/gnss_b1.net DESTINATION ./)
    add_test (NAME import-gnss-network-similar COMMAND $<TARGET_FILE:dnaimportwrapper> -n gnss_similar ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network.stn ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network.msr -r itrf2008 --override-input-ref-frame --search-similar-gnss-msr --quiet) 
    add_test (NAME import-gnss-network-exclude COMMAND $<TARGET_FILE:dnaimportwrapper> -n gnss_excl ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network.stn ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network.msr --exclude-stns-assoc-msrs "BEEC,261000380,356000780,349800490" --split) 
    add_test (NAME import-gnss-network-scaled COMMAND $<TARGET_FILE:dnaimportwrapper> -n gnss_scaled ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network.stn ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network.msr --baseline-scalar-file ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network.scalars -r GDA94) 
    add_test (NAME import-gnss-network-block1 COMMAND $<TARGET_FILE:dnaimportwrapper> -n gnss_b1 ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network.stn ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network.msr --export-dna --export-xml --single-xml-file --export-asl --export-aml --export-map --output-msr-to-stn --test-integrity -r GDA94) 
    add_test (NAME segment-gnss-network-block1-a COMMAND $<TARGET_FILE:dnasegmentwrapper> gnss_b1 --min 90 --max 90 --starting-stns 220700210)
    add_test (NAME segment-gnss-network-block1-b COMMAND $<TARGET_FILE:dnasegmentwrapper> gnss_b1 --min 110 --max 110 --net-file)
    add_test (NAME segment-gnss-network-block1-c COMMAND $<TARGET_FILE:dnasegmentwrapper> gnss_b1 --min 80 --max 200 --net-file --starting-stns 211300940 --verbose 3)
    add_test (NAME adjust-gnss-network-block1 COMMAND $<TARGET_FILE:dnaadjustwrapper> gnss_b1 --block1-phased --output-adj-msr --output-adj-gnss-units 1)
    add_test (NAME adjust-gnss-network-phased COMMAND $<TARGET_FILE:dnaadjustwrapper> gnss_b1 --phased --output-adj-msr --output-adj-gnss-units 2 --output-iter-adj-msr)
    add_test (NAME adjust-gnss-network-verb COMMAND $<TARGET_FILE:dnaadjustwrapper> gnss_b1 --verbose 5)
    add_test (NAME adjust-gnss-network-staged-a COMMAND $<TARGET_FILE:dnaadjustwrapper> gnss_b1 --staged-adjustment --create-stage-files --output-adj-msr --output-adj-gnss-units 2 --sort-adj-msr-field 4)
    add_test (NAME adjust-gnss-network-staged-b COMMAND $<TARGET_FILE:dnaadjustwrapper> gnss_b1 --staged-adjustment --purge-stage-files --output-adj-msr --output-adj-gnss-units 3 --output-stn-blocks --output-msr-blocks --sort-adj-msr-field 5)
    
    # 2. urban network (phased-sequential)
    add_test (NAME import-urban-network COMMAND $<TARGET_FILE:dnaimportwrapper> -n urban ${CMAKE_SOURCE_DIR}/../sampleData/urban-network.stn ${CMAKE_SOURCE_DIR}/../sampleData/urban-network.msr)
    add_test (NAME geoid-urban-network COMMAND $<TARGET_FILE:dnageoidwrapper> urban -g ${CMAKE_SOURCE_DIR}/../sampleData/urban-network-geoid.gsb --convert-stn-hts --export-dna-geo)
    add_test (NAME segment-urban-network COMMAND $<TARGET_FILE:dnasegmentwrapper> urban --min 50 --max 150 --test-integrity)
    add_test (NAME adjust-urban-network-verbose COMMAND $<TARGET_FILE:dnaadjustwrapper> urban --verbose 3)
    add_test (NAME adjust-urban-network COMMAND $<TARGET_FILE:dnaadjustwrapper> urban --output-adj-msr --phased --stn-corrections --export-sinex-file --export-xml-stn-file --export-dna-stn-file --output-pos-uncertainty --export-dna-msr --export-xml-msr)
    add_test (NAME plot-urban-network-01 COMMAND $<TARGET_FILE:dnaplotwrapper> urban --phased --label-sta --correction-arrows --label-corr --compute-corrections --scale-arrows 10.5 --error-ellipse --positional-uncertainty --scale-ellipse-c 10.5)
    add_test (NAME plot-urban-network-02 COMMAND $<TARGET_FILE:dnaplotwrapper> urban --phased --label-sta --label-constraints --correction-arrows --label-corr --compute-corrections --scale-arrows 10.5 --error-ellipse --positional-uncertainty --scale-ellipse-c 10.5 --block-number 2 --alternate-name)
    add_test (NAME plot-urban-seg-stn COMMAND $<TARGET_FILE:dnaplotwrapper> urban --graph-stn)
    add_test (NAME plot-urban-seg-msr COMMAND $<TARGET_FILE:dnaplotwrapper> urban --graph-msr)
    
    # 3. urban network (transform to GDA2020, phased-concurrent)
    add_test (NAME import-urban-network-thread COMMAND $<TARGET_FILE:dnaimportwrapper> -n urban_mt ${CMAKE_SOURCE_DIR}/../sampleData/urban-network.stn ${CMAKE_SOURCE_DIR}/../sampleData/urban-network.msr)
    add_test (NAME reftran-urban-network-thread COMMAND $<TARGET_FILE:dnareftranwrapper> urban_mt -r gda2020)
    add_test (NAME geoid-urban-network-thread COMMAND $<TARGET_FILE:dnageoidwrapper> urban_mt -g ${CMAKE_SOURCE_DIR}/../sampleData/urban-network-geoid.gsb --convert-stn-hts)
    add_test (NAME segment-urban-network-thread COMMAND $<TARGET_FILE:dnasegmentwrapper> urban_mt --min 50 --max 85 --verb 3)
    add_test (NAME adjust-urban-network-thread-01 COMMAND $<TARGET_FILE:dnaadjustwrapper> urban_mt --output-adj-msr --multi  --free-stn-sd 4.0 --fixed-stn-sd 0.000001 --max-iterations 20 --output-tstat-adj-msr --sort-adj-msr-field 2 --sort-stn-orig-order --stn-coord-types PLHhENz --angular-stn-type 1 --angular-msr-type 1 --precision-stn-linear 3 --precision-msr-linear 3 --precision-stn-angular 4 --precision-msr-angular 4 --output-pos-uncertainty --output-all-covariances --output-corrections-file)
    add_test (NAME plot-urban-network-thread COMMAND $<TARGET_FILE:dnaplotwrapper> urban_mt --phased --label-sta --label-font 16 --msr-line-w 0.5 --map-projection 3)
    add_test (NAME adjust-urban-network-thread-02 COMMAND $<TARGET_FILE:dnaadjustwrapper> urban_mt --output-adj-msr --multi --verb 5)

    # 4. urban network (phased-staged)
    add_test (NAME import-urban-network-stage COMMAND $<TARGET_FILE:dnaimportwrapper> -n urban_st ${CMAKE_SOURCE_DIR}/../sampleData/urban-network.stn ${CMAKE_SOURCE_DIR}/../sampleData/urban-network.msr)
    add_test (NAME geoid-urban-network-stage COMMAND $<TARGET_FILE:dnageoidwrapper> urban_st -g ${CMAKE_SOURCE_DIR}/../sampleData/urban-network-geoid.gsb --convert-stn-hts --export-dna-geo)
    add_test (NAME segment-urban-network-stage COMMAND $<TARGET_FILE:dnasegmentwrapper> urban_st --min 90 --max 90)
    add_test (NAME adjust-urban-network-stage COMMAND $<TARGET_FILE:dnaadjustwrapper> urban_st --phased --staged-adjustment --create-stage-files --output-adj-msr --export-sinex-file --output-pos-uncertainty --export-xml-stn-file --export-xml-msr-file --export-dna-stn-file --export-dna-msr --output-iter-adj-stn --output-iter-adj-stat --output-iter-adj-msr --output-iter-cmp-msr --stn-corrections --output-corrections-file)
    
    # 5. dynadjust project mode
    file (COPY ${CMAKE_SOURCE_DIR}/../sampleData/urban-network.stn DESTINATION ./)
    file (COPY ${CMAKE_SOURCE_DIR}/../sampleData/urban-network.msr DESTINATION ./)
    add_test (NAME dynadjust-proj-01 COMMAND $<TARGET_FILE:dynadjust> -p ${CMAKE_SOURCE_DIR}/../sampleData/sample.dnaproj --import --geoid --reftran --segment --adjust)
    add_test (NAME dynadjust-proj-02 COMMAND $<TARGET_FILE:dynadjust> -p ${CMAKE_SOURCE_DIR}/../sampleData/sample.dnaproj --import --geoid --reftran --segment --adjust --quiet)
    add_test (NAME dynadjust-name-01 COMMAND $<TARGET_FILE:dynadjust> -n sample --import --geoid --reftran --segment --adjust)

    # 6. urban data manipulation
    file (COPY ${CMAKE_SOURCE_DIR}/../sampleData/DynaML.xsd DESTINATION ./)
    add_test (NAME imp-urb00-dna-data COMMAND $<TARGET_FILE:dnaimportwrapper> -n urban_dna ${CMAKE_SOURCE_DIR}/../sampleData/urban-network.stn ${CMAKE_SOURCE_DIR}/../sampleData/urban-network.msr --export-xml --export-asl --export-aml --export-map --output-msr-to-stn)
    add_test (NAME imp-urb01-xml-data COMMAND $<TARGET_FILE:dnaimportwrapper> -n urban_xml ./urban_dnastn.xml ./urban_dnamsr.xml --include-msr-types gxyemsabdpqr --exclude-msr-types vz)
    add_test (NAME imp-urb02-xml-data COMMAND $<TARGET_FILE:dnaimportwrapper> -n urban_xml ./urban_dnastn.xml ./urban_dnamsr.xml --search-nearby-stn --nearby-stn-buffer 0.4)
    add_test (NAME imp-urb03-xml-data COMMAND $<TARGET_FILE:dnaimportwrapper> -n urban_xml ./urban_dnastn.xml ./urban_dnamsr.xml --search-similar-msr --ignore-similar-msr --flag-unused-stations)
    add_test (NAME imp-urb04-xml-data COMMAND $<TARGET_FILE:dnaimportwrapper> -n urban_xml ./urban_dnastn.xml ./urban_dnamsr.xml --v-scale 2.5 --p-scale 5.0 --l-scale 5.0 --h-scale 10.0)
    add_test (NAME imp-urb05-xml-data COMMAND $<TARGET_FILE:dnaimportwrapper> -n urban_xml ./urban_dnastn.xml ./urban_dnamsr.xml --include-stns-assoc-msrs "4000,1,1004,1042,1046,2,2215,4000,5,9004,1002,1003,1034,1039,1050,13,2101,2102,2105,2106,2109,2118,2119,2122,2123,2124,2125,2206,2214")
    add_test (NAME imp-urb06-xml-data COMMAND $<TARGET_FILE:dnaimportwrapper> -n urban_xml ./urban_dnastn.xml ./urban_dnamsr.xml --export-dna --export-asl --export-aml --export-map --output-msr-to-stn)
    add_test (NAME seg-urb00-xml-data COMMAND $<TARGET_FILE:dnasegmentwrapper> urban_xml --min 50 --max 50)
    add_test (NAME imp-urb07-xml-data COMMAND $<TARGET_FILE:dnaimportwrapper> -n urban_xml ./urban_dnastn.xml ./urban_dnamsr.xml --import-block-stn-msr 2)
    add_test (NAME imp-urb08-xml-data COMMAND $<TARGET_FILE:dnaimportwrapper> -n urban_xml ./urban_dnastn.xml ./urban_dnamsr.xml --geo-file urban.geo)
    add_test (NAME plt-urb01-xml-data COMMAND $<TARGET_FILE:dnaplotwrapper> urban_xml --centre-station 1004 --area-radius 5000 --plot-msr-types gxyasvz --msr-line-width 0.5)
    add_test (NAME plt-urb02-xml-data COMMAND $<TARGET_FILE:dnaplotwrapper> urban_xml --centre-latitude -37.480489013 --centre-longitude 144.573579814 --area-radius 3000 --omit-measurements)
    add_test (NAME imp-psu01-dna-data COMMAND $<TARGET_FILE:dnaimportwrapper> -n pseudo ${CMAKE_SOURCE_DIR}/../sampleData/pseudo.stn)
    add_test (NAME geo-psu00-dna-data COMMAND $<TARGET_FILE:dnageoidwrapper> pseudo -g ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network-geoid.gsb --export-dna-geo-file)
    add_test (NAME imp-psu02-dna-data COMMAND $<TARGET_FILE:dnaimportwrapper> -n pseudo ${CMAKE_SOURCE_DIR}/../sampleData/pseudo.stn ${CMAKE_SOURCE_DIR}/../sampleData/pseudo-driver-file.msr --simulate --geo-file pseudo.geo --export-xml)
    add_test (NAME imp-psu03-xml-data COMMAND $<TARGET_FILE:dnaimportwrapper> -n pseudo pseudostn.xml pseudomsr.xml)
    add_test (NAME geo-psu01-xml-data COMMAND $<TARGET_FILE:dnageoidwrapper> pseudo -g ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network-geoid.gsb --convert --interpolation-method 0)
    add_test (NAME adj-psu00-xml-data COMMAND $<TARGET_FILE:dnaadjustwrapper> pseudo --output-adj-msr --free-stn-sd 5.0 --fixed-stn-sd 0.000005 --max-iterations 15 --output-tstat-adj-msr --sort-adj-msr-field 7 --sort-stn-orig-order --stn-coord-types XYZPLHhENz --angular-stn-type 1 --angular-msr-type 1 --precision-stn-linear 3 --precision-msr-linear 3 --precision-stn-angular 4 --precision-msr-angular 4 --output-pos-uncertainty --output-all-covariances --output-corrections-file)
    add_test (NAME imp-gnss0-xml-data COMMAND $<TARGET_FILE:dnaimportwrapper> -n gnss_xml ./gnssstn.xml ./gnssmsr.xml --bounding-box "-36.3000,145.4500,-36.4500,146.4500" --get-msrs-transcending-box --split-gnss-cluster-msrs --prefer-single-x-as-g)
    add_test (NAME imp-gnss1-xml-data COMMAND $<TARGET_FILE:dnaimportwrapper> -n gnss_xml ./gnssstn.xml ./gnssmsr.xml --include-stns-assoc-msrs "BEEC,BNLA,EURA,HOTH,MNSF,MYRT,320500750,385900240" --get-msrs-transcending-box --split-gnss-cluster-msrs --prefer-single-x-as-g -r itrf2014 --override-input-ref-frame)

    # 7. geoid data manipulation
    add_test (NAME geo-interpolate-01 COMMAND $<TARGET_FILE:dnageoidwrapper> -g ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network-geoid.gsb --interactive --latitude -36.3348253617 --longitude 145.5741006771)
    add_test (NAME geo-interpolate-02 COMMAND $<TARGET_FILE:dnageoidwrapper> -g ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network-geoid.gsb --interactive --latitude -36.2704890597 --longitude 146.4809871537 --interpolation-method 0)
    add_test (NAME geo-interpolate-03 COMMAND $<TARGET_FILE:dnageoidwrapper> -g ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network-geoid.gsb --summary)
    add_test (NAME geo-interpolate-04 COMMAND $<TARGET_FILE:dnageoidwrapper> --version)
    add_test (NAME geo-interpolate-05 COMMAND $<TARGET_FILE:dnageoidwrapper> -g ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network-geoid.gsb -t ${CMAKE_SOURCE_DIR}/../sampleData/geoid-points-dat.txt)
    add_test (NAME geo-interpolate-06 COMMAND $<TARGET_FILE:dnageoidwrapper> -g ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network-geoid.gsb -t ${CMAKE_SOURCE_DIR}/../sampleData/geoid-points-csv.csv)    
    add_test (NAME geo-interpolate-07 COMMAND $<TARGET_FILE:dnageoidwrapper> -g ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network-geoid.gsb -t ${CMAKE_SOURCE_DIR}/../sampleData/geoid-points-dat.txt --decimal-degrees --direction 0 --export-dna-geo-file)
    add_test (NAME geo-interpolate-08 COMMAND $<TARGET_FILE:dnageoidwrapper> -g ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network-geoid.gsb -t ${CMAKE_SOURCE_DIR}/../sampleData/geoid-points-csv.csv --decimal-degrees --direction 0 --export-dna-geo-file)
    add_test (NAME geo-ntv2-create-01 COMMAND $<TARGET_FILE:dnageoidwrapper> -d ${CMAKE_SOURCE_DIR}/../sampleData/ausgeoid09_gda94_v1.01_clip_1x1.dat -c -g ausgeoid_clip_default.gsb)
    add_test (NAME geo-ntv2-create-02 COMMAND $<TARGET_FILE:dnageoidwrapper> -d ${CMAKE_SOURCE_DIR}/../sampleData/ausgeoid09_gda94_v1.01_clip_1x1.dat -c -g ausgeoid_clip_1.0.1.0.gsb --grid-shift radians --grid-version 1.0.1.0 --system-fr ___GDA94 --system-to ___AHD71 --sub-grid-n 1D-grid --creation 21.04.2021 --update 22.04.2021)
    add_test (NAME geo-ntv2-export-01 COMMAND $<TARGET_FILE:dnageoidwrapper> -g ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network-geoid.gsb --export-ntv2-asc)
    add_test (NAME geo-ntv2-export-02 COMMAND $<TARGET_FILE:dnageoidwrapper> -g ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network-geoid.gsb --export-ntv2-asc --grid-shift-type radians)
    add_test (NAME geo-ntv2-export-03 COMMAND $<TARGET_FILE:dnageoidwrapper> -g ./gnss-network-geoid.gsb.asc --export-ntv2-gsb)
    add_test (NAME geo-ntv2-export-04 COMMAND $<TARGET_FILE:dnageoidwrapper> -g ./gnss-network-geoid.gsb.asc --export-ntv2-gsb --grid-shift-type radians)
    add_test (NAME imp-outside COMMAND $<TARGET_FILE:dnaimportwrapper> -n outside ${CMAKE_SOURCE_DIR}/../sampleData/urban-network.stn ${CMAKE_SOURCE_DIR}/../sampleData/urban-network.msr)
    add_test (NAME geo-outside-01 COMMAND $<TARGET_FILE:dnageoidwrapper> outside -g ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network-geoid.gsb --convert --verbose 1)
    add_test (NAME geo-outside-02 COMMAND $<TARGET_FILE:dnageoidwrapper> outside -g ./gnss-network-geoid.gsb.asc --convert --verbose 2)
    add_test (NAME geo-inside-01 COMMAND $<TARGET_FILE:dnageoidwrapper> gnss -g ./gnss-network-geoid.gsb.asc --convert --export-dna-geo)
    add_test (NAME geo-inside-02 COMMAND $<TARGET_FILE:dnageoidwrapper> -g ./gnss-network-geoid.gsb.asc -t ${CMAKE_SOURCE_DIR}/../sampleData/geoid-points-dat.txt)
    add_test (NAME geo-inside-03 COMMAND $<TARGET_FILE:dnageoidwrapper> -g ./gnss-network-geoid.gsb.asc -t ${CMAKE_SOURCE_DIR}/../sampleData/geoid-points-dat.txt --interpolation-method 0)

    # bash command to check results
    #add_test (NAME test-urban-phased-network COMMAND bash -c "diff <(tail -n +62 urban.phased.adj) <(tail -n +62 ${CMAKE_SOURCE_DIR}/../sampleData/urban.phased.adj.expected)")
    #add_test (NAME test-urban-thread-network COMMAND bash -c "diff <(tail -n +64 urban_mt.phased-mt.adj) <(tail -n +64 ${CMAKE_SOURCE_DIR}/../sampleData/urban_mt.phased-mt.adj.expected)")

    # 8. gnss reference frame transformations
    add_test (NAME ref-gnss01-network COMMAND $<TARGET_FILE:dnareftranwrapper> gnss -r itrf2014 -e 01.01.2020)
    add_test (NAME ref-gnss02-network COMMAND $<TARGET_FILE:dnareftranwrapper> gnss -r itrf1988 -e 03.12.1995)
    add_test (NAME ref-gnss03-network COMMAND $<TARGET_FILE:dnareftranwrapper> gnss -r itrf1989)
    add_test (NAME ref-gnss04-network COMMAND $<TARGET_FILE:dnareftranwrapper> gnss -r itrf1990)
    add_test (NAME ref-gnss05-network COMMAND $<TARGET_FILE:dnareftranwrapper> gnss -r itrf1991)
    add_test (NAME ref-gnss06-network COMMAND $<TARGET_FILE:dnareftranwrapper> gnss -r itrf2005 -e 05.05.2005 --export-xml --single-xml-file --verb 3)
    add_test (NAME ref-gnss07-network COMMAND $<TARGET_FILE:dnareftranwrapper> gnss -r itrf1992 --verb 3)
    add_test (NAME ref-gnss08-network COMMAND $<TARGET_FILE:dnareftranwrapper> gnss -r gda94 --export-xml --single-xml-file --verb 3)
    add_test (NAME ref-gnss09-network COMMAND $<TARGET_FILE:dnareftranwrapper> gnss -r itrf1988)
    add_test (NAME ref-gnss10-network COMMAND $<TARGET_FILE:dnareftranwrapper> gnss -r itrf1993)
    add_test (NAME ref-gnss11-network COMMAND $<TARGET_FILE:dnareftranwrapper> gnss -r itrf1994)
    add_test (NAME ref-gnss12-network COMMAND $<TARGET_FILE:dnareftranwrapper> gnss -r itrf1996)
    add_test (NAME ref-gnss13-network COMMAND $<TARGET_FILE:dnareftranwrapper> gnss -r itrf1997)

    # 9. gnss reference frame transformations with plate motion model
    add_test (NAME ref-itrf-pmm-01 COMMAND $<TARGET_FILE:dnaimportwrapper> -n itrf05_itrf1997_a -r itrf2005 ${CMAKE_SOURCE_DIR}/../sampleData/TEST_ITRF05.SNX)
    add_test (NAME ref-itrf-pmm-02 COMMAND $<TARGET_FILE:dnareftranwrapper> itrf05_itrf1997_a -r itrf1997 -e 25.10.2017 --export-dna --verb 2 --plate-model-option 1 -b ${CMAKE_SOURCE_DIR}/../sampleData/PB2002_plates.dig -m ${CMAKE_SOURCE_DIR}/../sampleData/PB2002_poles.dat)
    add_test (NAME ref-itrf-pmm-03 COMMAND $<TARGET_FILE:dnaimportwrapper> -n itrf05_itrf1997_b -r itrf2005 ${CMAKE_SOURCE_DIR}/../sampleData/TEST_ITRF05.SNX)
    add_test (NAME ref-itrf-pmm-04 COMMAND $<TARGET_FILE:dnareftranwrapper> itrf05_itrf1997_b -r itrf1997 -e 01.01.2020 --export-dna --verb 3 --plate-model-option 1 -b ${CMAKE_SOURCE_DIR}/../sampleData/PB2002_plates.dig -m ${CMAKE_SOURCE_DIR}/../sampleData/PB2002_poles.dat)
    add_test (NAME ref-itrf-pmm-05 COMMAND $<TARGET_FILE:dnaimportwrapper> -n apr -r itrf2008 ${CMAKE_SOURCE_DIR}/../sampleData/apr.ITRF2008.04.06.2020.stn ${CMAKE_SOURCE_DIR}/../sampleData/apr.ITRF2008.04.06.2020.msr)
    add_test (NAME ref-itrf-pmm-06 COMMAND $<TARGET_FILE:dnareftranwrapper> apr -r itrf2008 -e 01.01.2021 --export-dna --verb 2 --plate-model-option 1 -b ${CMAKE_SOURCE_DIR}/../sampleData/MORVEL56_plates.dig -m ${CMAKE_SOURCE_DIR}/../sampleData/NNR-MORVEL56_poles.dat)
    #add_test (NAME ref-itrf-pmm-07 COMMAND bash -c "diff <(tail -n +6 apr.ITRF2008.01.01.2021.stn) <(tail -n +4 ${CMAKE_SOURCE_DIR}/../sampleData/apr.ITRF2008.01.01.2021.stn.expected)")

    # 10. station discontinuities
    add_test (NAME imp-discont-01 COMMAND $<TARGET_FILE:dnaimportwrapper> -n discont -r itrf2005 ${CMAKE_SOURCE_DIR}/../sampleData/TEST_ITRF05.SNX --discontinuity-file ${CMAKE_SOURCE_DIR}/../sampleData/disconts20201205.snx --export-discont-file)
    add_test (NAME imp-discont-02 COMMAND $<TARGET_FILE:dnaimportwrapper> -n discont -r itrf2005 ${CMAKE_SOURCE_DIR}/../sampleData/TEST_ITRF05.SNX --discontinuity-file ${CMAKE_SOURCE_DIR}/../sampleData/disconts20201205.snx --split-gnss --include-stn "ALIC" --export-dna)
    add_test (NAME imp-discont-03 COMMAND $<TARGET_FILE:dnaimportwrapper> -n discont -r itrf2014 --override-input-ref-frame ${CMAKE_SOURCE_DIR}/../sampleData/TEST_ITRF05.SNX ${CMAKE_SOURCE_DIR}/../sampleData/sa-gnss-stn.xml ${CMAKE_SOURCE_DIR}/../sampleData/sa-gnss-msr.xml --prefer-single-x-as-g --flag-unused --discontinuity-file ${CMAKE_SOURCE_DIR}/../sampleData/disconts20201205.snx --remove-ignored-msr --split-gnss --include-stns-assoc-msrs "ALIC" --export-dna --export-xml)
    add_test (NAME imp-discont-04 COMMAND $<TARGET_FILE:dnaimportwrapper> -n discont -r itrf2005 ${CMAKE_SOURCE_DIR}/../sampleData/TEST_ITRF05.SNX --export-xml)
    add_test (NAME imp-discont-05 COMMAND $<TARGET_FILE:dnaimportwrapper> -n discont -r itrf2000 --override-input-ref-frame ./discontstn.xml ./discontmsr.xml --discontinuity-file ${CMAKE_SOURCE_DIR}/../sampleData/disconts20201205.snx)
    
    # 11. measurements to stations sorting
    add_test (NAME imp-m2s-sort-01 COMMAND $<TARGET_FILE:dnaimportwrapper> -n gnss ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network.stn ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network.msr --output-msr-to-stn --sort-msr-to-stn-field 1 -r GDA94) 

    # 12. help modules and version
    add_test (NAME imp-help-00 COMMAND $<TARGET_FILE:dnaimportwrapper> -h)
    add_test (NAME imp-help-01 COMMAND $<TARGET_FILE:dnaimportwrapper> --help-module standard)
    add_test (NAME imp-help-02 COMMAND $<TARGET_FILE:dnaimportwrapper> --help-module reference)
    add_test (NAME imp-help-03 COMMAND $<TARGET_FILE:dnaimportwrapper> --help-module screening)
    add_test (NAME imp-help-04 COMMAND $<TARGET_FILE:dnaimportwrapper> --help-module gnss)
    add_test (NAME imp-help-05 COMMAND $<TARGET_FILE:dnaimportwrapper> --help-module simulation)
    add_test (NAME imp-help-06 COMMAND $<TARGET_FILE:dnaimportwrapper> --help-module output)
    add_test (NAME imp-help-07 COMMAND $<TARGET_FILE:dnaimportwrapper> --help-module export)
    add_test (NAME imp-help-08 COMMAND $<TARGET_FILE:dnaimportwrapper> --help-module generic)
    add_test (NAME imp-version-01 COMMAND $<TARGET_FILE:dnaimportwrapper> --version)

    add_test (NAME geo-help-00 COMMAND $<TARGET_FILE:dnageoidwrapper> -h)
    add_test (NAME geo-help-01 COMMAND $<TARGET_FILE:dnageoidwrapper> --help-module standard)
    add_test (NAME geo-help-02 COMMAND $<TARGET_FILE:dnageoidwrapper> --help-module interpolation)
    add_test (NAME geo-help-03 COMMAND $<TARGET_FILE:dnageoidwrapper> --help-module ntv2)
    add_test (NAME geo-help-04 COMMAND $<TARGET_FILE:dnageoidwrapper> --help-module interactive)
    add_test (NAME geo-help-05 COMMAND $<TARGET_FILE:dnageoidwrapper> --help-module file)
    add_test (NAME geo-help-06 COMMAND $<TARGET_FILE:dnageoidwrapper> --help-module export)
    add_test (NAME geo-help-07 COMMAND $<TARGET_FILE:dnageoidwrapper> --help-module generic)
    add_test (NAME geo-version-01 COMMAND $<TARGET_FILE:dnageoidwrapper> --version)

    add_test (NAME seg-help-00 COMMAND $<TARGET_FILE:dnasegmentwrapper> -h)
    add_test (NAME seg-help-01 COMMAND $<TARGET_FILE:dnasegmentwrapper> --help-module standard)
    add_test (NAME seg-help-02 COMMAND $<TARGET_FILE:dnasegmentwrapper> --help-module configuration)
    add_test (NAME seg-help-03 COMMAND $<TARGET_FILE:dnasegmentwrapper> --help-module generic)
    add_test (NAME seg-version-01 COMMAND $<TARGET_FILE:dnasegmentwrapper> --version)

    add_test (NAME ref-help-00 COMMAND $<TARGET_FILE:dnareftranwrapper> -h)
    add_test (NAME ref-help-01 COMMAND $<TARGET_FILE:dnareftranwrapper> --help-module standard)
    add_test (NAME ref-help-02 COMMAND $<TARGET_FILE:dnareftranwrapper> --help-module transformation)
    add_test (NAME ref-help-03 COMMAND $<TARGET_FILE:dnareftranwrapper> --help-module export)
    add_test (NAME ref-help-04 COMMAND $<TARGET_FILE:dnareftranwrapper> --help-module generic)
    add_test (NAME ref-version-01 COMMAND $<TARGET_FILE:dnareftranwrapper> --version)

    add_test (NAME adj-help-00 COMMAND $<TARGET_FILE:dnaadjustwrapper> -h)
    add_test (NAME adj-help-01 COMMAND $<TARGET_FILE:dnaadjustwrapper> --help-module standard)
    add_test (NAME adj-help-02 COMMAND $<TARGET_FILE:dnaadjustwrapper> --help-module adjustment)
    add_test (NAME adj-help-03 COMMAND $<TARGET_FILE:dnaadjustwrapper> --help-module phased)
    add_test (NAME adj-help-04 COMMAND $<TARGET_FILE:dnaadjustwrapper> --help-module configuration)
    add_test (NAME adj-help-05 COMMAND $<TARGET_FILE:dnaadjustwrapper> --help-module stage)
    add_test (NAME adj-help-06 COMMAND $<TARGET_FILE:dnaadjustwrapper> --help-module output)
    add_test (NAME adj-help-07 COMMAND $<TARGET_FILE:dnaadjustwrapper> --help-module export)
    add_test (NAME adj-help-08 COMMAND $<TARGET_FILE:dnaadjustwrapper> --help-module generic)
    add_test (NAME adj-version-01 COMMAND $<TARGET_FILE:dnaadjustwrapper> --version)

    add_test (NAME plt-help-00 COMMAND $<TARGET_FILE:dnaplotwrapper> -h)
    add_test (NAME plt-help-01 COMMAND $<TARGET_FILE:dnaplotwrapper> --help-module standard)
    add_test (NAME plt-help-02 COMMAND $<TARGET_FILE:dnaplotwrapper> --help-module data)
    add_test (NAME plt-help-03 COMMAND $<TARGET_FILE:dnaplotwrapper> --help-module mapping)
    add_test (NAME plt-help-04 COMMAND $<TARGET_FILE:dnaplotwrapper> --help-module title)
    add_test (NAME plt-help-05 COMMAND $<TARGET_FILE:dnaplotwrapper> --help-module generic)
    add_test (NAME plt-version-01 COMMAND $<TARGET_FILE:dnaplotwrapper> --version)

    add_test (NAME dyn-help-00 COMMAND $<TARGET_FILE:dynadjust> -h)
    add_test (NAME dyn-help-01 COMMAND $<TARGET_FILE:dynadjust> --help-module standard)
    add_test (NAME dyn-help-02 COMMAND $<TARGET_FILE:dynadjust> --help-module generic)
    add_test (NAME dyn-version-01 COMMAND $<TARGET_FILE:dynadjust> --version)

    # 13. Handle database id, output measurement to stations, output adjustment information on each iteration, scale normals to unity, report results
    add_test (NAME import-dbid COMMAND $<TARGET_FILE:dnaimportwrapper> -n dbid ${CMAKE_SOURCE_DIR}/../sampleData/dsg.stn ${CMAKE_SOURCE_DIR}/../sampleData/dsg.msr ${CMAKE_SOURCE_DIR}/../sampleData/dsg-ignored.msr) 
    add_test (NAME adjust-dbid-01 COMMAND $<TARGET_FILE:dnaadjustwrapper> dbid --output-adj-msr --output-database-ids --output-ignored-msrs --sort-adj-msr-field 6 --output-msr-to-stn --sort-msr-to-stn-field 1 --output-iter-adj-stn --output-iter-adj-stat --output-iter-adj-msr --output-iter-cmp-msr)
    add_test (NAME adjust-dbid-02 COMMAND $<TARGET_FILE:dnaadjustwrapper> dbid --scale-normals-to-unity)
    add_test (NAME adjust-dbid-03 COMMAND $<TARGET_FILE:dnaadjustwrapper> dbid --report-results --output-adj-msr --output-pos-uncertainty --output-apu-vcv-units 1 --constraints "236300210,CCC")
    add_test (NAME adjust-dbid-04 COMMAND $<TARGET_FILE:dnaadjustwrapper> dbid --comments "This is a comment that is quite lengthy in content and is relatively meaningless.  Feel free to delete this comment.")
    add_test (NAME adjust-dbid-05 COMMAND $<TARGET_FILE:dnaadjustwrapper> -p dbid.dnaproj)

    # 13. Renaming, no export of flagged stations, no network name, non-contiguous networks, import block, nearby stations
    add_test (NAME import-misc-01 COMMAND $<TARGET_FILE:dnaimportwrapper> -n misc ${CMAKE_SOURCE_DIR}/../sampleData/dsg.stn ${CMAKE_SOURCE_DIR}/../sampleData/dsg.msr ${CMAKE_SOURCE_DIR}/../sampleData/dsg-ignored.msr --stn-renaming-file ${CMAKE_SOURCE_DIR}/../sampleData/dsg.renaming --export-xml)
    add_test (NAME import-misc-02 COMMAND $<TARGET_FILE:dnaimportwrapper> -n misc ${CMAKE_SOURCE_DIR}/../sampleData/dsg.stn ${CMAKE_SOURCE_DIR}/../sampleData/dsg-retained.msr ${CMAKE_SOURCE_DIR}/../sampleData/dsg-retained.msr --search-similar-msr --export-dna --export-xml --single-xml-file --output-msr-to-stn)
    add_test (NAME import-misc-03 COMMAND $<TARGET_FILE:dnaimportwrapper> -n misc ${CMAKE_SOURCE_DIR}/../sampleData/dsg.stn ${CMAKE_SOURCE_DIR}/../sampleData/dsg.msr ${CMAKE_SOURCE_DIR}/../sampleData/dsg-retained.msr ${CMAKE_SOURCE_DIR}/../sampleData/dsg-retained.msr ${CMAKE_SOURCE_DIR}/../sampleData/dsg-ignored.msr --search-similar-msr --ignore-similar-msr --flag-unused-stations)
    add_test (NAME import-misc-04 COMMAND $<TARGET_FILE:dnaimportwrapper> -n misc ${CMAKE_SOURCE_DIR}/../sampleData/dsg.stn ${CMAKE_SOURCE_DIR}/../sampleData/dsg.msr ${CMAKE_SOURCE_DIR}/../sampleData/dsg-retained.msr ${CMAKE_SOURCE_DIR}/../sampleData/dsg-ignored.msr --export-xml)
    add_test (NAME segment-misc-plt COMMAND $<TARGET_FILE:dnasegmentwrapper> misc --min 500 --max 500)
    add_test (NAME plot-misc-omit COMMAND $<TARGET_FILE:dnaplotwrapper> misc --omit-measurements --omit-title-block)
    add_test (NAME plot-misc-all COMMAND $<TARGET_FILE:dnaplotwrapper> misc --plot-msr-types "ABCDEGHIJKLMNPQRSVXYZ")
    add_test (NAME plot-misc-gph-stn COMMAND $<TARGET_FILE:dnaplotwrapper> misc --graph-stn)
    add_test (NAME plot-misc-gph-msr COMMAND $<TARGET_FILE:dnaplotwrapper> misc --graph-msr)
    add_test (NAME import-misc-05 COMMAND $<TARGET_FILE:dnaimportwrapper> -n misc ./misc.xml ${CMAKE_SOURCE_DIR}/../sampleData/sa-gnss-stn.xml --flag-unused-stations --export-dna --export-xml)
    add_test (NAME reftran-misc-01 COMMAND $<TARGET_FILE:dnareftranwrapper> misc -r itrf1991 --export-xml --verb 3)
    add_test (NAME reftran-misc-02 COMMAND $<TARGET_FILE:dnareftranwrapper> -p misc.dnaproj)
    add_test (NAME segment-misc-01 COMMAND $<TARGET_FILE:dnasegmentwrapper> misc --min 500 --max 500 --starting-stns 230900140)
    add_test (NAME segment-misc-02 COMMAND $<TARGET_FILE:dnasegmentwrapper> misc --min 50 --max 100 --starting-stns 230900140 --seg-file ./misc.seg)
    add_test (NAME import-misc-06 COMMAND $<TARGET_FILE:dnaimportwrapper> -n misc ./miscstn.xml ./miscmsr.xml --import-block-stn-msr 2)
    add_test (NAME import-misc-07 COMMAND $<TARGET_FILE:dnaimportwrapper> -p misc.dnaproj)
    add_test (NAME import-noname-01 COMMAND $<TARGET_FILE:dnaimportwrapper> ${CMAKE_SOURCE_DIR}/../sampleData/dsg.stn ${CMAKE_SOURCE_DIR}/../sampleData/dsg.msr)
    add_test (NAME import-noname-02 COMMAND $<TARGET_FILE:dnaimportwrapper> ${CMAKE_SOURCE_DIR}/../sampleData/dsg.stn ${CMAKE_SOURCE_DIR}/../sampleData/dsg.msr)
    add_test (NAME import-noncontiguous COMMAND $<TARGET_FILE:dnaimportwrapper> -n noncontig ${CMAKE_SOURCE_DIR}/../sampleData/dsg.stn ${CMAKE_SOURCE_DIR}/../sampleData/dsg.msr ${CMAKE_SOURCE_DIR}/../sampleData/skye-tutorial.stn ${CMAKE_SOURCE_DIR}/../sampleData/skye-tutorial.msr -r itrf2000 --override-input-ref-frame)
    add_test (NAME segment-noncontiguous-01 COMMAND $<TARGET_FILE:dnasegmentwrapper> noncontig --min 3 --max 5 --search-level 1 --test-integrity --verbose 3)
    add_test (NAME segment-noncontiguous-02 COMMAND $<TARGET_FILE:dnasegmentwrapper> noncontig --min 3 --max 5 --contiguous-blocks 0 --search-level 1 --test-integrity  --verbose 3)
    add_test (NAME segment-noncontiguous-03 COMMAND $<TARGET_FILE:dnasegmentwrapper> -p noncontig.dnaproj)
    add_test (NAME import-block-01 COMMAND $<TARGET_FILE:dnaimportwrapper> -n misc ./miscstn.xml ./miscmsr.xml)
    add_test (NAME segment-block COMMAND $<TARGET_FILE:dnasegmentwrapper> misc --min 2 --max 3)
    add_test (NAME import-block-02 COMMAND $<TARGET_FILE:dnaimportwrapper> -n misc ${CMAKE_SOURCE_DIR}/../sampleData/dsg.stn ${CMAKE_SOURCE_DIR}/../sampleData/dsg.msr --seg-file ${CMAKE_SOURCE_DIR}/../sampleData/misc.seg --import-block 2)
    add_test (NAME import-include-msrs COMMAND $<TARGET_FILE:dnaimportwrapper> -n misc ./miscstn.xml ./miscmsr.xml --include-msr-types "ABCDEGHIJKLMNPQRSVXYZ")
    add_test (NAME import-exclude-msrs COMMAND $<TARGET_FILE:dnaimportwrapper> -n null ./miscstn.xml ./miscmsr.xml --exclude-msr-types "ABCDEGHIJKLMNPQRSVXYZ" --flag --export-dna)
    add_test (NAME import-stn-msr-connect COMMAND $<TARGET_FILE:dnaimportwrapper> -n connect ./miscstn.xml ./miscmsr.xml --include-stns-assoc-msrs "365300060,360100260,269100210")
    add_test (NAME import-all COMMAND $<TARGET_FILE:dnaimportwrapper> -n all 
        ./miscstn.xml 
        ./miscmsr.xml
        ${CMAKE_SOURCE_DIR}/../sampleData/apr.ITRF2008.04.06.2020.stn 
        ${CMAKE_SOURCE_DIR}/../sampleData/apr.ITRF2008.04.06.2020.msr
        ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network.stn 
        ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network.msr
        ${CMAKE_SOURCE_DIR}/../sampleData/sa-gnss-stn.xml 
        ${CMAKE_SOURCE_DIR}/../sampleData/sa-gnss-msr.xml
        ${CMAKE_SOURCE_DIR}/../sampleData/skye-tutorial.stn 
        ${CMAKE_SOURCE_DIR}/../sampleData/skye-tutorial.msr 
        ${CMAKE_SOURCE_DIR}/../sampleData/TEST_ITRF05.SNX 
        ${CMAKE_SOURCE_DIR}/../sampleData/urban-network.stn 
        ${CMAKE_SOURCE_DIR}/../sampleData/urban-network.msr)
    add_test (NAME plot-all-01 COMMAND $<TARGET_FILE:dnaplotwrapper> all --map-projection 1)
    add_test (NAME plot-all-02 COMMAND $<TARGET_FILE:dnaplotwrapper> all --map-projection 2)
    add_test (NAME plot-all-03 COMMAND $<TARGET_FILE:dnaplotwrapper> all --map-projection 3)
    add_test (NAME plot-all-04 COMMAND $<TARGET_FILE:dnaplotwrapper> all --map-projection 4)
    add_test (NAME plot-all-05 COMMAND $<TARGET_FILE:dnaplotwrapper> all --map-projection 5)
    add_test (NAME plot-all-06 COMMAND $<TARGET_FILE:dnaplotwrapper> all --map-projection 6)
    add_test (NAME plot-all-07 COMMAND $<TARGET_FILE:dnaplotwrapper> all --map-projection 7)
    add_test (NAME plot-all-08 COMMAND $<TARGET_FILE:dnaplotwrapper> all --bounding "-36.3000,-200.0,-36.4500,200.0")
    add_test (NAME plot-all-09 COMMAND $<TARGET_FILE:dnaplotwrapper> all --bounding "100.3000,130.0,-100.4500,150.0")
    add_test (NAME plot-all-10 COMMAND $<TARGET_FILE:dnaplotwrapper> all --bounding "80.3000,130.0,-80.4500,150.0")
    add_test (NAME plot-all-11 COMMAND $<TARGET_FILE:dnaplotwrapper> all --bounding "60.3000,100.0,-60.4500,180.0")
    add_test (NAME plot-all-12 COMMAND $<TARGET_FILE:dnaplotwrapper> all --centre-latitude "-36.0101" --centre-longitude "145.0202")
    add_test (NAME plot-all-13 COMMAND $<TARGET_FILE:dnaplotwrapper> all --centre-latitude "-66.0101" --centre-longitude "145.0202")
    add_test (NAME plot-all-14 COMMAND $<TARGET_FILE:dnaplotwrapper> all --centre-latitude "-86.0101" --centre-longitude "145.0202")
    add_test (NAME plot-all-15 COMMAND $<TARGET_FILE:dnaplotwrapper> all --title "A plot generated by cmake testing." --org-unit "Geoscience Australia" --org-subunit "National Geodesy")
    add_test (NAME plot-all-16 COMMAND $<TARGET_FILE:dnaplotwrapper> all --export-png --omit-title)
    add_test (NAME plot-all-17 COMMAND $<TARGET_FILE:dnaplotwrapper> all --export-png --plate ${CMAKE_SOURCE_DIR}/../sampleData/MORVEL56_plates.dig --map 8)
    
    # 14. Exceptions
    ### IMPORT ###
    # no options
    add_test (NAME import-no-option COMMAND $<TARGET_FILE:dnaimportwrapper>)
    # invalid options
    add_test (NAME import-invalid-option COMMAND $<TARGET_FILE:dnaimportwrapper> -x)
    # invalid input file
    add_test (NAME import-invalid-file COMMAND $<TARGET_FILE:dnaimportwrapper> -n invalid invalidfile.txt)
    # the --search-nearby-stn option in import will return a failure if nearby stations are found.  In this case, check it is non-zero (i.e. it will fail!)
    add_test (NAME import-nearby COMMAND $<TARGET_FILE:dnaimportwrapper> -n urban ${CMAKE_SOURCE_DIR}/../sampleData/urban-network.stn ${CMAKE_SOURCE_DIR}/../sampleData/urban-network.msr --search-nearby-stn --nearby-stn-buffer 10)
    # files don't exist
    add_test (NAME import-no-files COMMAND $<TARGET_FILE:dnaimportwrapper> -n bigdata ${CMAKE_SOURCE_DIR}/../sampleData/bigdata.stn ${CMAKE_SOURCE_DIR}/../sampleData/bigdata.msr)
    # reference frame doesn't exist
    add_test (NAME import-no-frame COMMAND $<TARGET_FILE:dnaimportwrapper> -n sample -r itrf1975 ${CMAKE_SOURCE_DIR}/../sampleData/dsg.stn ${CMAKE_SOURCE_DIR}/../sampleData/dsg.msr)
    # no stations and measurements (generated above)
    add_test (NAME import-no-data COMMAND $<TARGET_FILE:dnaimportwrapper> -n null ./null.stn ./null.msr)
    # no dynaml.xsd
    file (REMOVE ./DynaML.xsd)
    add_test (NAME import-no-xsd-file COMMAND $<TARGET_FILE:dnaimportwrapper> -n gnss gnss-networkstn.xml gnss-networkmsr.xml)
    # no geoid file
    add_test (NAME import-no-geoid COMMAND $<TARGET_FILE:dnaimportwrapper> -n geoid --geo-file ./nofile.geo)
    # no project file
    add_test (NAME import-no-project COMMAND $<TARGET_FILE:dnaimportwrapper> -p ./nofile.dnaproj)
    # measurement stns not in station file
    add_test (NAME import-no-stns COMMAND $<TARGET_FILE:dnaimportwrapper> -n nostn ${CMAKE_SOURCE_DIR}/../sampleData/urban-network.stn ${CMAKE_SOURCE_DIR}/../sampleData/dsg.msr)
    # no help module
    add_test (NAME import-no-help COMMAND $<TARGET_FILE:dnaimportwrapper> --help-module cplusplus)

    set_tests_properties(import-no-option import-invalid-option import-invalid-file import-nearby import-no-files import-no-frame 
        import-no-data import-no-xsd-file import-no-geoid import-no-project import-no-stns import-no-help
        PROPERTIES WILL_FAIL TRUE)

    ### REFTRAN ###
    # no options
    add_test (NAME reftran-no-option COMMAND $<TARGET_FILE:dnareftranwrapper>)
    # invalid options
    add_test (NAME reftran-invalid-option COMMAND $<TARGET_FILE:dnareftranwrapper> -x)
    # no project file
    add_test (NAME reftran-no-project COMMAND $<TARGET_FILE:dnareftranwrapper> -p ./nofile.dnaproj)
    # no name
    add_test (NAME reftran-no-name COMMAND $<TARGET_FILE:dnareftranwrapper> -r "gda94")
    # no reference frame
    add_test (NAME reftran-no-frame COMMAND $<TARGET_FILE:dnareftranwrapper> all)
    # no binary files
    add_test (NAME reftran-no-bst-bms COMMAND $<TARGET_FILE:dnareftranwrapper> extremelylargenetwork -r "itrf1990")
    # reference frame doesn't exist
    add_test (NAME reftran-bad-frame COMMAND $<TARGET_FILE:dnareftranwrapper> all -r itrf1975)
    # epoch doesn't exist
    add_test (NAME reftran-bad-epoch COMMAND $<TARGET_FILE:dnareftranwrapper> all -r "itrf2000" -e "yyyy")
    # no plate boundary file
    add_test (NAME reftran-no-discont-file COMMAND $<TARGET_FILE:dnareftranwrapper> all -r "ITRF2008" --plate-boundary-file nofile.txt)
    # no euler pole file
    add_test (NAME reftran-no-euler-file COMMAND $<TARGET_FILE:dnareftranwrapper> all -r "ITRF2008" --plate-pole-file nofile.txt)
    # no plate model option argument
    add_test (NAME reftran-no-model-option COMMAND $<TARGET_FILE:dnareftranwrapper> all -r "ITRF2014" -e "31.12.9999" --plate-model-option)
    # no help module
    add_test (NAME reftran-no-help COMMAND $<TARGET_FILE:dnareftranwrapper> --help-module cplusplus)
    
    
    set_tests_properties(
        reftran-no-option reftran-invalid-option reftran-no-project reftran-no-name reftran-no-frame reftran-no-bst-bms 
        reftran-bad-frame reftran-bad-epoch reftran-no-discont-file reftran-no-euler-file
        reftran-no-model-option reftran-no-help
        PROPERTIES WILL_FAIL TRUE)

    ### GEOID ###
    # no options
    add_test (NAME geoid-no-option COMMAND $<TARGET_FILE:dnageoidwrapper>)
    # invalid options
    add_test (NAME geoid-invalid-option COMMAND $<TARGET_FILE:dnageoidwrapper> -x)
    # no project file
    add_test (NAME geoid-no-project COMMAND $<TARGET_FILE:dnageoidwrapper> -p ./nofile.dnaproj)
    # no standard options
    add_test (NAME geoid-no-std-options COMMAND $<TARGET_FILE:dnageoidwrapper> -g ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network-geoid.gsb)
    # no interpolation input file
    add_test (NAME geoid-no-input-file COMMAND $<TARGET_FILE:dnageoidwrapper> largenet)
    # no standard options
    add_test (NAME geoid-no-bst COMMAND $<TARGET_FILE:dnageoidwrapper> -g ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network-geoid.gsb largenet)
    # no help module
    add_test (NAME geoid-no-help COMMAND $<TARGET_FILE:dnageoidwrapper> --help-module cplusplus)
    # no geoid file
    add_test (NAME geoid-no-gsb COMMAND $<TARGET_FILE:dnageoidwrapper> gnss -g nogridfile.gsb)
    
    set_tests_properties(
        geoid-no-option geoid-invalid-option geoid-no-project geoid-no-std-options geoid-no-input-file geoid-no-bst geoid-no-help geoid-no-gsb
        PROPERTIES WILL_FAIL TRUE)

    ### SEGMENT ###
    # no options
    add_test (NAME segment-no-option COMMAND $<TARGET_FILE:dnasegmentwrapper>)
    # invalid options
    add_test (NAME segment-invalid-option COMMAND $<TARGET_FILE:dnasegmentwrapper> -x)
    # no project file
    add_test (NAME segment-no-project COMMAND $<TARGET_FILE:dnasegmentwrapper> -p ./nofile.dnaproj)
    # no binary files
    add_test (NAME segment-no-bst-bms COMMAND $<TARGET_FILE:dnasegmentwrapper> extremelylargenetwork)
    # no net file
    add_test (NAME segment-no-net-01 COMMAND $<TARGET_FILE:dnaimportwrapper> -n nonetfile ${CMAKE_SOURCE_DIR}/../sampleData/dsg.stn ${CMAKE_SOURCE_DIR}/../sampleData/dsg.msr)
    add_test (NAME segment-no-net-02 COMMAND $<TARGET_FILE:dnasegmentwrapper> nonetfile --net-file)
    # no option arguments
    add_test (NAME segment-no-opt-arg-01 COMMAND $<TARGET_FILE:dnasegmentwrapper> nonetfile --starting-stns)
    add_test (NAME segment-no-opt-arg-02 COMMAND $<TARGET_FILE:dnasegmentwrapper> nonetfile --min)
    add_test (NAME segment-no-opt-arg-03 COMMAND $<TARGET_FILE:dnasegmentwrapper> nonetfile --max)
    add_test (NAME segment-no-opt-arg-04 COMMAND $<TARGET_FILE:dnasegmentwrapper> nonetfile --contiguous)
    add_test (NAME segment-no-opt-arg-05 COMMAND $<TARGET_FILE:dnasegmentwrapper> nonetfile --search)
    # no help module
    add_test (NAME segment-no-help COMMAND $<TARGET_FILE:dnasegmentwrapper> --help-module cplusplus)
    
    set_tests_properties(
        segment-no-option segment-invalid-option segment-no-project segment-no-bst-bms segment-no-net-02 segment-no-help
        segment-no-opt-arg-01 segment-no-opt-arg-02 segment-no-opt-arg-03 segment-no-opt-arg-04 segment-no-opt-arg-05
        PROPERTIES WILL_FAIL TRUE)

    ### ADJUST ###
    # no options
    add_test (NAME adjust-no-option COMMAND $<TARGET_FILE:dnaadjustwrapper>)
    # invalid options
    add_test (NAME adjust-invalid-option COMMAND $<TARGET_FILE:dnaadjustwrapper> -x)
    # no project file
    add_test (NAME adjust-no-project COMMAND $<TARGET_FILE:dnaadjustwrapper> -p ./nofile.dnaproj)
    # no network name
    add_test (NAME adjust-no-name COMMAND $<TARGET_FILE:dnaadjustwrapper> --phased)
    # no help module
    add_test (NAME adjust-no-help COMMAND $<TARGET_FILE:dnaadjustwrapper> --help-module cplusplus)
    # no binary files
    add_test (NAME adjust-no-bst-bms COMMAND $<TARGET_FILE:dnaadjustwrapper> largenet)
    # no segment file
    add_test (NAME import-no-seg COMMAND $<TARGET_FILE:dnaimportwrapper> -n noseg ${CMAKE_SOURCE_DIR}/../sampleData/dsg.stn ${CMAKE_SOURCE_DIR}/../sampleData/dsg.msr)
    add_test (NAME adjust-no-seg COMMAND $<TARGET_FILE:dnaadjustwrapper> noseg --phased)
    # no memory mapped files from previous adjustment
    add_test (NAME import-no-memmap COMMAND $<TARGET_FILE:dnaimportwrapper> -n memmap ${CMAKE_SOURCE_DIR}/../sampleData/dsg.stn ${CMAKE_SOURCE_DIR}/../sampleData/dsg.msr)
    add_test (NAME segment-no-memmap COMMAND $<TARGET_FILE:dnasegmentwrapper> memmap --min 2 --max 3)
    add_test (NAME adjust-no-memmap-01 COMMAND $<TARGET_FILE:dnaadjustwrapper> memmap --staged --create --purge)
    add_test (NAME adjust-no-memmap-02 COMMAND $<TARGET_FILE:dnaadjustwrapper> memmap --staged)
    add_test (NAME adjust-no-stn-exists COMMAND $<TARGET_FILE:dnaadjustwrapper> memmap --constraints "no-name,CCC")
    add_test (NAME adjust-no-constraint COMMAND $<TARGET_FILE:dnaadjustwrapper> memmap --constraints "236300210,AAA")
    
    set_tests_properties(
        adjust-no-option adjust-invalid-option adjust-no-project adjust-no-name adjust-no-help adjust-no-bst-bms adjust-no-seg 
        adjust-no-memmap-02 adjust-no-stn-exists adjust-no-constraint
        PROPERTIES WILL_FAIL TRUE)

    ### PLOT ###
    # no options
    add_test (NAME plot-no-option COMMAND $<TARGET_FILE:dnaplotwrapper>)
    # invalid options
    add_test (NAME plot-invalid-option COMMAND $<TARGET_FILE:dnaplotwrapper> -x)
    # no project file
    add_test (NAME plot-no-project COMMAND $<TARGET_FILE:dnaplotwrapper> -p ./nofile.dnaproj)
    # no standard options
    add_test (NAME plot-no-std-options COMMAND $<TARGET_FILE:dnaplotwrapper> -g ${CMAKE_SOURCE_DIR}/../sampleData/gnss-network-plot.gsb)
    # no such network
    add_test (NAME plot-no-network COMMAND $<TARGET_FILE:dnaplotwrapper> largenet)
    # no network-name
    add_test (NAME plot-no-name COMMAND $<TARGET_FILE:dnaplotwrapper> --centre-station "PM1")
    # no help module
    add_test (NAME plot-no-help COMMAND $<TARGET_FILE:dnaplotwrapper> --help-module cplusplus)
    # bounding box error
    add_test (NAME plot-box-ew COMMAND $<TARGET_FILE:dnaplotwrapper> all --bounding "-36.3000,146.4500,-36.4500,145.4500")
    add_test (NAME plot-box-ns COMMAND $<TARGET_FILE:dnaplotwrapper> all --bounding "-36.4500,145.4500,-36.3000,146.4500")
    # no seg file, no apu file, no cor file, no plate
    add_test (NAME import-no-seg-apu-cor COMMAND $<TARGET_FILE:dnaimportwrapper> -n nosegapucor ${CMAKE_SOURCE_DIR}/../sampleData/dsg.stn ${CMAKE_SOURCE_DIR}/../sampleData/dsg.msr)
    add_test (NAME plot-no-seg COMMAND $<TARGET_FILE:dnaplotwrapper> nosegapucor --phased)
    add_test (NAME plot-no-cor COMMAND $<TARGET_FILE:dnaplotwrapper> nosegapucor --correction-arrows)
    add_test (NAME plot-no-apu COMMAND $<TARGET_FILE:dnaplotwrapper> nosegapucor --error-ellipses)
    add_test (NAME plot-no-plate COMMAND $<TARGET_FILE:dnaplotwrapper> nosegapucor --plate ./noplate.file)
    
    set_tests_properties(
        plot-no-option plot-invalid-option plot-no-project plot-no-std-options plot-no-network plot-no-name plot-no-help 
        plot-box-ew plot-box-ns plot-no-seg plot-no-cor plot-no-apu plot-no-plate 
        PROPERTIES WILL_FAIL TRUE)

    ### DYNADJUST ###
    # no options
    add_test (NAME dyna-no-option COMMAND $<TARGET_FILE:dynadjust>)
    # invalid option
    add_test (NAME dyna-invalid-option COMMAND $<TARGET_FILE:dynadjust> -x)
    # no help module
    add_test (NAME dyna-no-help COMMAND $<TARGET_FILE:dynadjust> --help-module cplusplus)
    # no project file and network name
    add_test (NAME dyna-no-proj-no-name COMMAND $<TARGET_FILE:dynadjust> --import)
    # no programs
    add_test (NAME dyna-no-programs COMMAND $<TARGET_FILE:dynadjust>  -p ${CMAKE_SOURCE_DIR}/../sampleData/sample.dnaproj)
    # no project file
    add_test (NAME dyna-no-project COMMAND $<TARGET_FILE:dynadjust> -p ./nofile.dnaproj)
    # name doesn't match project file
    add_test (NAME dyna-name-proj-mismatch COMMAND $<TARGET_FILE:dynadjust> -p ./nofile.dnaproj -n noname)

    set_tests_properties(
        dyna-no-option dyna-invalid-option dyna-no-help dyna-no-proj-no-name dyna-no-programs
        dyna-no-project dyna-name-proj-mismatch
        PROPERTIES WILL_FAIL TRUE)

    
    
    # set execution dependencies (the execution of tests must be sequential)
    set_tests_properties(
        import-gnss-network geoid-gnss-network adjust-gnss-network
        PROPERTIES RUN_SERIAL TRUE)
    set_tests_properties(
        import-urban-network geoid-urban-network segment-urban-network adjust-urban-network
        PROPERTIES RUN_SERIAL TRUE)
    set_tests_properties(
        import-urban-network-thread reftran-urban-network-thread geoid-urban-network-thread segment-urban-network-thread adjust-urban-network-thread-01
        PROPERTIES RUN_SERIAL TRUE)
    set_tests_properties(test-gnss-network PROPERTIES DEPENDS adjust-gnss-network)
    set_tests_properties(ref-itrf-pmm-06 PROPERTIES DEPENDS ref-itrf-pmm-05)
    #set_tests_properties(ref-itrf-pmm-07 PROPERTIES DEPENDS ref-itrf-pmm-06)

endif ()

message (" ")
message ("===========================================================================")
message ("Finished configuring DynAdjust ${DYNADJUST_VERSION} (${CMAKE_BUILD_TYPE}).")
message (" ")
